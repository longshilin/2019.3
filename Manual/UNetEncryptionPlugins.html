<!DOCTYPE html><html class="no-js" lang="zh_CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content="Multiplayer Encryption Plug-ins - Unity Manual">
<title>Multiplayer Encryption Plug-ins - Unity Manual</title>
<meta property="og:image" content="https://docs.unity3d.com/zh_CN/2019.3/uploads/Main/UNetMultiplayerEncryption.svg">
<meta name="description" content="Unity Multiplayer can make use of an encryption Plug-in, so that all data you send over the network passes through the encryption plug-in before being sent. This allows you to protect your game against cheating by packet manipulation and attacks on your dedicated game servers.">
<meta property="og:description" content="Unity Multiplayer can make use of an encryption Plug-in, so that all data you send over the network passes through the encryption plug-in before being sent. This allows you to protect your game against cheating by packet manipulation and attacks on your dedicated game servers.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'zh_CN';
      var page = 'UNetEncryptionPlugins';
      if(!page) page = 'index';
      var version = '2019.3';
      var docs_versions = [{version: '2019.3',version_string: '2019.3'},{version: '2019.2',version_string: '2019.2'},{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/zh_CN/2019.3/Manual/UNetEncryptionPlugins.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2019.3/Manual/UNetEncryptionPlugins.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/ja/2019.3/Manual/UNetEncryptionPlugins.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2019.3/Manual/UNetEncryptionPlugins.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2019.3/Manual/UNetEncryptionPlugins.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/2019.3/Documentation/Manual/UNetEncryptionPlugins.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/UNetEncryptionPlugins.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/UNetEncryptionPlugins.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/UNetEncryptionPlugins.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/UNetEncryptionPlugins.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/UNetEncryptionPlugins.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/UNetEncryptionPlugins.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/UNetEncryptionPlugins.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/UNetEncryptionPlugins.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/UNetEncryptionPlugins.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/UNetEncryptionPlugins.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/UNetEncryptionPlugins.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/UNetEncryptionPlugins.html">5.6</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.3/Documentation/Manual/UNetEncryptionPlugins.html">English</a></li>
<li><a data-lang="ja" href="/ja/2019.3/Manual/UNetEncryptionPlugins.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.3/Manual/UNetEncryptionPlugins.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.3/Manual/UNetEncryptionPlugins.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>Manual</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/UNetEncryptionPlugins.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/UNetEncryptionPlugins.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/UNetEncryptionPlugins.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/UNetEncryptionPlugins.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/UNetEncryptionPlugins.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/UNetEncryptionPlugins.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/UNetEncryptionPlugins.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/UNetEncryptionPlugins.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/UNetEncryptionPlugins.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/UNetEncryptionPlugins.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/UNetEncryptionPlugins.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/UNetEncryptionPlugins.html">5.6</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (2019.3)</a></li>
<li><a href="UNet.html">多玩家和联网</a></li>
<li>Multiplayer Encryption Plug-ins</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="class-NetworkServerSimple.html"></a></span><div class="tip">NetworkServerSimple</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UnityWebRequest.html"></a></span><div class="tip">UnityWebRequest</div>
</div>
</div></div>
<h1>Multiplayer Encryption Plug-ins</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Unity Multiplayer can make use of an encryption Plug-in, so that all data you send over the network passes through the encryption plug-in before being sent. This allows you to protect your game against cheating by packet manipulation and attacks on your dedicated game servers.</p>

<p>Unity Multiplayer does not have a built-in encryption plug-in, so you must provide your own plug-in that implements an encryption algorithm, and which implements the mandatory functions listed further below.</p>

<p>The following diagram illustrates how Unity Multiplayer uses your encryption Plug-in, if you provide one.</p>

<figure>
<img src="../uploads/Main/UNetMultiplayerEncryption.svg" alt="The data flow when using an encryption plug-in with Unity Multiplayer">
<figcaption>The data flow when using an encryption plug-in with Unity Multiplayer</figcaption>
</figure>

<h2><strong>How to use an Encryption Plug-in</strong></h2>

<p>To instruct your game or app to use an encryption Plug-in, you must call <code>UnityEngine.Networking.NetworkTransport.LoadEncryptionLibrary(path)</code> where <code>path</code> is the path to your compiled plugin. Typically on Windows it will be <code>string.Format("{0}/Plugins/UnetEncryption.dll", Application.dataPath)</code>.</p>

<p>When you call this function, Unity checks the file exists, and that it implements all the mandatory functions (listed below). These are the functions that Unity’s multiplayer system itself will call. If you create your own encryption plugin, you will likely need to add more functions that you call from your C# code. For example, to initialise your algorithm or to provide your plug-in with key values. You can do this in the <a href="NativePlugins.html">usual way for native plugins</a> callable from C#.</p>

<p>Note: The location of a plugin in the built version of your game is not necessarily the same as in your Assets folder, and it may differ between target platforms. You may need to write code that detects the current runtime environment and select the correct path based on that.</p>

<p>You can get a sample encryption plugin and a sample Unity project using it from <a href="https://github.com/Unity-Technologies/UnetEncryptionExample">Unity’s GitHub</a>. This is provided to illustrate a starting point for implementing your own Plug-in.</p>

<h2><strong>Mandatory Functions</strong></h2>

<p>Any encryption Plug-in you create or use must provide the following functions. Unity will fail to load the plug-in if it does not define these. These are the functions that will be called by the Unity runtime itself. Plugins will typically provide <em>additional</em> functions to be called from the user’s C# code, for example for registering keys.</p>

<h3>To Encrypt Data</h3>

<pre><code>int UNetEncryptionLib_Encrypt(
    void * payload,
    int payload_len,
    void * dest,
    int &amp; dest_len,
    int connection_id,
    bool isConnect);
</code></pre>

<p>This function performs the encryption. This is called by Unity’s networking whenever a packet is to be sent over the network.</p>

<h4>Parameters</h4>

<ul>
<li>payload is the data to be encrypted.</li>
<li>payload_len is the length of the <em>payload</em> buffer, in bytes.</li>
<li>dest is the buffer into which the plugin should write the encrypted data.</li>
<li>dest_len is the capacity in bytes of the dest buffer. The plugin must replace this value with the number of bytes <em>actually written</em> into dest.</li>
<li>connection_id is the local identifier of the connection.</li>
<li>isConnect is true if this packet is a connection request. When this is true, the plugin must have been told ahead of time (by game code) which key to use. When this is false, it is expected that the plugin already has a mapping from this value to a key to use. See the example plugin for an implementation.</li>
</ul>

<h4>Return value</h4>

<p><code>Encrypt</code> must return zero on success. On any other return value, the runtime will drop the packet without sending it.</p>

<h3>To Decrypt Data</h3>

<pre><code>int UNetEncryptionLib_Decrypt(
    void * payload,
    int payload_len,
    void * dest,
    int &amp; dest_len,
    int &amp; key_id);
</code></pre>

<p>This function performs the decryption. This is called by Unity networking whenever a packet is received from the network.</p>

<h4>Parameters</h4>

<ul>
<li>
<code>payload</code> is the received packet.</li>
<li>
<code>payload_len</code> is the length in bytes of the payload buffer.</li>
<li>
<code>dest</code> is the buffer into which the plugin should write the decrypted data.</li>
<li>
<code>dest_len</code> is the capacity in bytes of the dest buffer. The plugin must replace this value with the number of bytes <em>actually written</em> into dest.</li>
<li>
<code>key_id</code> is an integer identifier. The plugin should write a value that uniquely identifies the decryption key used. On the server this value will be passed back into <code>ConnectionIdAssigned</code> if a new connection is accepted.</li>
</ul>

<h4>Return value</h4>

<p><code>Decrypt</code> must return zero on success. On any other return value, the packet is dropped without being processed further.</p>

<h3>SafeMaxPacketSize</h3>

<pre><code>unsigned short UNetEncryptionLib_SafeMaxPacketSize(
    unsigned short mtu);
</code></pre>

<p>You should call this function from your game to modify <code>ConnectionConfig.PacketSize</code> (also known as the <em>maximum transmission unit</em>, or MTU) before calling <code>NetworkTransport.AddHost</code>.</p>

<p>For example, your game might normally use an MTU of 1000 bytes. If <code>ConnectionConfig.PacketSize</code> is set to 1000 bytes before passing it into <code>NetworkTransport.AddHost</code> (via <code>HostConfig.DefaultConfig</code>), then the NetworkTransport layer will send no more than 1000 bytes of cleartext in a single packet.</p>

<p>An encryption plugin will typically add some overhead due to header information placed before the payload, as well as rounding-up the payload to an encryption block size. For example, if you are sending 18 bytes of cleartext, and the plug-in needs to add 49 bytes of header and using AES to encrypt data with a block size of 16 bytes, then the algorithm would produce a packet of 81 bytes (18 bytes of cleartext rounds up to 32 bytes of ciphertext, and then an additional 49 bytes of header).</p>

<p>Unity calls this function to ensure that packets that are about to be sent do not go over the limit of what’s possible to send, given the network MTU and your encryption algorithm’s ciphertext expansion and padding.</p>

<h4>Parameters</h4>

<ul>
<li>
<code>mtu</code> is the maximum transmission unit. The largest packet size that you want the plugin to generate.</li>
</ul>

<h4>Return value</h4>

<p>The maximum amount of cleartext that should be provided to a single call to Encrypt, in order for the plugin to generate packets not larger than the MTU.</p>

<p>You must set the maximum packet size in your connection config to tell Unity Multiplayer to split data up so that it fits your encryption requirements. If you notice that some of your messages do not successfully transmit over the network, it could be because they were dropped due to exceeding the maximum packet size.</p>

<h3>ConnectionIdAssigned</h3>

<pre><code>void UNetEncryptionLib_ConnectionIdAssigned(
    int key_id,
    unsigned short connection_id);
</code></pre>

<p>This is called on the server when a new connection has been accepted and an ID assigned to it.</p>

<h4>Parameters</h4>

<ul>
<li>
<code>key_id</code> The key identifier, which was written by the corresponding previous call to <code>Decrypt</code> for this packet.</li>
<li>
<code>connection_id</code> The connection id that will be used from this point forth. In particular, as a parameter to subsequent <code>Encrypt</code> calls when sending packets back to the client.</li>
</ul>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="class-NetworkServerSimple.html"></a></span><div class="tip">NetworkServerSimple</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="UnityWebRequest.html"></a></span><div class="tip">UnityWebRequest</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2020 Unity Technologies. Publication 2019.3</div>
<div class="menu">
<a href="https://unity3d.com/learn">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
