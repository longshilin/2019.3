<!DOCTYPE html><html class="no-js" lang="zh_CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<meta property="og:title" content="脚本限制 - Unity Manual">
<title>脚本限制 - Unity Manual</title>
<meta name="description" content="Unity strives to provide a common scripting API and experience across all platforms it supports. However, some platforms have inherent restrictions. To help you understand these restrictions and support cross-platform code, the following table describes which restrictions apply to each platform and scripting backend:">
<meta property="og:description" content="Unity strives to provide a common scripting API and experience across all platforms it supports. However, some platforms have inherent restrictions. To help you understand these restrictions and support cross-platform code, the following table describes which restrictions apply to each platform and scripting backend:">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFiles/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script>
      var docs_type = 'Manual';
      var lang = 'zh_CN';
      var page = 'ScriptingRestrictions';
      if(!page) page = 'index';
      var version = '2019.3';
      var docs_versions = [{version: '2019.3',version_string: '2019.3'},{version: '2019.2',version_string: '2019.2'},{version: '2019.1',version_string: '2019.1'},{version: '2018.4',version_string: '2018.4'},{version: '2018.3',version_string: '2018.3'},{version: '2018.2',version_string: '2018.2'},{version: '2018.1',version_string: '2018.1'},{version: '2017.4',version_string: '2017.4'},{version: '2017.3',version_string: '2017.3'},{version: '2017.2',version_string: '2017.2'},{version: '2017.1',version_string: '2017.1'},{version: '5.6',version_string: '560'},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/zh_CN/2019.3/Manual/ScriptingRestrictions.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2019.3/Manual/ScriptingRestrictions.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/ja/2019.3/Manual/ScriptingRestrictions.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2019.3/Manual/ScriptingRestrictions.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2019.3/Manual/ScriptingRestrictions.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/2019.3/Documentation/Manual/ScriptingRestrictions.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/ScriptingRestrictions.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/ScriptingRestrictions.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/ScriptingRestrictions.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/ScriptingRestrictions.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/ScriptingRestrictions.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/ScriptingRestrictions.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/ScriptingRestrictions.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/ScriptingRestrictions.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/ScriptingRestrictions.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/ScriptingRestrictions.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/ScriptingRestrictions.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/ScriptingRestrictions.html">5.6</a></li>
</ul></div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">Manual</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">Scripting API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2019.3/Documentation/Manual/ScriptingRestrictions.html">English</a></li>
<li><a data-lang="ja" href="/ja/2019.3/Manual/ScriptingRestrictions.html">日本語</a></li>
<li><a data-lang="es" href="/es/2019.3/Manual/ScriptingRestrictions.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2019.3/Manual/ScriptingRestrictions.html">한국어</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>Manual</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2019.3</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;"><ul>
<li><a class="docs_version_url_2019.3" href="/zh_CN/2019.3/Manual/ScriptingRestrictions.html">2019.3</a></li>
<li><a class="docs_version_url_2019.2" href="/zh_CN/2019.2/Manual/ScriptingRestrictions.html">2019.2</a></li>
<li><a class="docs_version_url_2019.1" href="/zh_CN/2019.1/Manual/ScriptingRestrictions.html">2019.1</a></li>
<li><a class="docs_version_url_2018.4" href="/zh_CN/2018.4/Manual/ScriptingRestrictions.html">2018.4</a></li>
<li><a class="docs_version_url_2018.3" href="/zh_CN/2018.3/Manual/ScriptingRestrictions.html">2018.3</a></li>
<li><a class="docs_version_url_2018.2" href="/zh_CN/2018.2/Manual/ScriptingRestrictions.html">2018.2</a></li>
<li><a class="docs_version_url_2018.1" href="/zh_CN/2018.1/Manual/ScriptingRestrictions.html">2018.1</a></li>
<li><a class="docs_version_url_2017.4" href="/zh_CN/2017.4/Manual/ScriptingRestrictions.html">2017.4</a></li>
<li><a class="docs_version_url_2017.3" href="/zh_CN/2017.3/Manual/ScriptingRestrictions.html">2017.3</a></li>
<li><a class="docs_version_url_2017.2" href="/zh_CN/2017.2/Manual/ScriptingRestrictions.html">2017.2</a></li>
<li><a class="docs_version_url_2017.1" href="/zh_CN/2017.1/Manual/ScriptingRestrictions.html">2017.1</a></li>
<li><a class="docs_version_url_560" href="/zh_CN/560/Manual/ScriptingRestrictions.html">5.6</a></li>
</ul></div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (2019.3)</a></li>
<li><a href="ScriptingSection.html">脚本</a></li>
<li><a href="ScriptingConcepts.html">脚本概述</a></li>
<li>脚本限制</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="GenericFunctions.html"></a></span><div class="tip">Generic Functions</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="script-Serialization.html"></a></span><div class="tip">脚本序列化</div>
</div>
</div></div>
<h1>脚本限制</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Unity strives to provide a common scripting API and experience across all platforms it supports. However, some platforms have inherent restrictions. To help you understand these restrictions and support cross-platform code, the following table describes which restrictions apply to each platform and scripting backend:</p>

<h2>.NET 4.x 等效脚本运行时</h2>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong><em>平台（脚本后端）</em></strong></th>
	<th style="text-align:left;"><strong><em>提前编译</em></strong></th>
	<th style="text-align:left;"><strong><em>无线程</em></strong></th>
	<th style="text-align:left;"><strong><em>.NET Core 类库子集</em></strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Android (IL2CPP)</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">Android (Mono)</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">iOS (IL2CPP)</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">PlayStation 4 (IL2CPP)</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">PlayStation Vita (IL2CPP)</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">独立平台 (IL2CPP)</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">独立平台 (Mono)</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">Switch (IL2CPP)</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">通用 Windows 平台 (IL2CPP)</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">通用 Windows 平台 (.NET)</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;">&amp;#x2714;</td>
</tr>
<tr>
	<td style="text-align:left;">WebGL (IL2CPP)</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;" colspan="2"></td>
</tr>
<tr>
	<td style="text-align:left;">WiiU (Mono)</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
<tr>
	<td style="text-align:left;">XBox One (IL2CPP)</td>
	<td style="text-align:left;">&amp;#x2714;</td>
	<td style="text-align:left;"></td>
	<td style="text-align:left;"></td>
</tr>
</tbody>
</table>

<p><a name="AOT"></a> </p>

<h2>提前编译</h2>

<p>Some platforms do not allow runtime code generation. Therefore, any managed code which depends upon just-in-time (JIT) compilation on the target device will fail. Instead, you need to compile all of the managed code ahead-of-time (AOT). Often, this distinction doesn’t matter, but in a few specific cases, AOT platforms require additional consideration.</p>

<h3>System.Reflection.Emit</h3>

<p>An AOT platform cannot implement any of the methods in the <code>System.Reflection.Emit</code> namespace. The rest of <code>System.Reflection</code> is acceptable, as long as the compiler can infer that the code used via reflection needs to exist at runtime.</p>

<h3>序列化</h3>

<p>AOT platforms can encounter issues with serialization and deserlization due to the use of reflection. If a type or method is only used via reflection as part of serialization or deserialization, the AOT compiler cannot detect that the code needs to be generated for the type or method.</p>

<h3>通用虚拟方法</h3>

<p>Generic methods require the compiler to do some additional work to expand the code written by the developer to the code executed on the device. For example, you need different code for <code>List</code> with an <code>int</code> or a <code>double</code>. In the presence of virtual methods, where behavior is determined at runtime rather than compile time, the compiler can easily require runtime code generation in places where it is not entirely obvious from the source code.</p>

<p>The following code example works exactly as expected on a JIT platform (it prints “Message value: Zero” to the console once):</p>

<pre><code>using UnityEngine;
using System;

public class AOTProblemExample : MonoBehaviour, IReceiver
{
    public enum AnyEnum 
    {
        Zero,
        One,
    }

    void Start() 
    {
        // Subtle trigger: The type of manager *must* be
        // IManager, not Manager, to trigger the AOT problem.
        IManager manager = new Manager();
        manager.SendMessage(this, AnyEnum.Zero);
    }

    public void OnMessage&lt;T&gt;(T value) 
    {
        Debug.LogFormat("Message value: {0}", value);
    }
}

public class Manager : IManager 
{
    public void SendMessage&lt;T&gt;(IReceiver target, T value) {
        target.OnMessage(value);
    }
}

public interface IReceiver
{
    void OnMessage&lt;T&gt;(T value);
}

public interface IManager 
{
    void SendMessage&lt;T&gt;(IReceiver target, T value);
}
</code></pre>

<p>However, when you execute this code on an AOT platform with the IL2CPP scripting backend, this exception occurs:</p>

<pre><code>ExecutionEngineException: Attempting to call method 'AOTProblemExample::OnMessage&lt;AOTProblemExample+AnyEnum&gt;' for which no ahead of time (AOT) code was generated.
  at Manager.SendMessage[T] (IReceiver target, .T value) [0x00000] in &lt;filename unknown&gt;:0 
  at AOTProblemExample.Start () [0x00000] in &lt;filename unknown&gt;:0
</code></pre>

<p>同样，Mono 脚本后端提供以下类似的异常：</p>

<pre><code>  ExecutionEngineException: Attempting to JIT compile method 'Manager:SendMessage&lt;AOTProblemExample/AnyEnum&gt; (IReceiver,AOTProblemExample/AnyEnum)' while running with --aot-only.
    at AOTProblemExample.Start () [0x00000] in &lt;filename unknown&gt;:0
</code></pre>

<p>The AOT compiler does not realize that it should generate code for the generic method <code>OnMessage</code> with a <code>T</code> of <code>AnyEnum</code>, so it continues, skipping this method. When that method is called, and the runtime can’t find the proper code to execute, it returns this error message.</p>

<p>To work around an AOT issue like this, you can force the compiler to generate the proper code. You can add the following example method to the <code>AOTProblemExample</code> class:</p>

<pre><code>public void UsedOnlyForAOTCodeGeneration() 
{
    // IL2CPP needs only this line.
    OnMessage(AnyEnum.Zero);

    // Mono also needs this line. Note that we are
    // calling directly on the Manager, not the IManager interface.
    new Manager().SendMessage(null, AnyEnum.Zero);

    // Include an exception so we can be sure to know if this method is ever called.
    throw new InvalidOperationException("This method is used for AOT code generation only. Do not call it at runtime.");
}
</code></pre>

<p>When the compiler encounters the explicit call to <code>OnMessage</code> with a <code>T</code> of <code>AnyEnum</code>, it generates the proper code for the runtime to execute. The method <code>UsedOnlyForAOTCodeGeneration</code> does not need to be called; it just needs to exist for the compiler to see it.</p>

<h3>Calling managed methods from native code</h3>

<p>Managed methods that need to be marshaled to a C function pointer so that they can be called from native code have a few restructions on AOT platforms:</p>

<ul>
<li>The managed method must be a static method</li>
<li>The managed method must have the <code>[MonoPInvokeCallback]</code> attribute</li>
</ul>

<p><a name="threads"></a> </p>

<h2>无线程</h2>

<p>Some platforms do not support the use of threads, so any managed code that uses the <code>System.Threading</code> namespace will fail at runtime. Also, some parts of the .NET class libraries implicitly depend upon threads. An often-used example is the <code>System.Timers.Timer</code> class, which depends on support for threads.</p>

<h2>Exception filters</h2>

<p>IL2CPP does not support C# exception filters. You should modify the code that depends on exception filters into the proper <code>catch</code> blocks.</p>

<hr>

<ul>
<li><p><span class="page-edit">2019–05–28 Page amended
</span><br></p></li>
<li><p><span class="page-history">删除了三星电视支持。</span></p></li>
<li><p><span class="page-history">.Net 3.5 scripting runtime deprecated in Unity <a href="../Manual/30_search.html?q=newin20183">2018.3</a> <span class="search-words">NewIn20183</span></span></p></li>
</ul>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="GenericFunctions.html"></a></span><div class="tip">Generic Functions</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="script-Serialization.html"></a></span><div class="tip">脚本序列化</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">Copyright © 2020 Unity Technologies. Publication 2019.3</div>
<div class="menu">
<a href="https://unity3d.com/learn">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
